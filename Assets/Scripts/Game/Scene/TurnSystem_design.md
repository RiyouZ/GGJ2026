# TurnSystem 设计文档

## 描述
- 负责调度回合
- 触发胜利与失败条件

## 回合阶段
- 回合分为三个阶段：
	1. 回合开始阶段：初始化本回合数据，触发回合开始事件。
	2. 回合进行阶段：
		- 玩家操作阶段：玩家可操作，点击“结束回合”按钮后进入下一阶段。
		- 棋子移动阶段：所有棋子依次或并行移动，移动阶段玩家不可操作。
	3. 回合结束阶段：所有棋子移动完毕，触发回合结束事件。

## 状态机设计
- 采用有限状态机（FSM）管理回合流转。
- 主要状态：等待玩家操作 → 棋子移动 → 胜利判定 → 回合结束/继续。
- 状态切换条件：
	- 玩家点击结束按钮
	- 棋子全部移动完毕
	- 胜利判定结果

## 胜利判定
- 棋子移动结束后，进行胜利判定：
	- 判定条件：所有我方棋子均站在指定胜利格子上。
	- 满足条件则游戏胜利，结束回合轮转。
	- 未满足则进入下一回合。

## 异常与中断情况
- 玩家可能的中断情况：
	- 主动退出游戏
- 棋子无法移动不作为异常处理，直接跳过该棋子。

## 回合描述
- 玩家操作阶段：玩家点击结束进入到下一回合
- 棋子移动阶段：遍历每个棋子，同时进行一次单位移动，如果有可以多次单位移动的棋子按移动回合移动。
	- 移动阶段玩家不可操作棋子
	- 当所有棋子移动结束后 进行胜利判定
		- 胜利判定：指定格子皆被我方占领
	- 未胜利进入 玩家操作阶段

## 方法
- Update()
	- **描述**：进行异步的轮转调度，驱动状态机流转。
- StartTurn()
	- **描述**：初始化回合数据，进入回合开始阶段，触发 OnTurnStart 事件。
- EndTurn()
	- **描述**：回合结束时调用，清理回合数据，触发 OnTurnEnd 事件，准备进入下一回合。
- CheckVictory()
	- **描述**：在棋子全部移动结束后调用，判断是否满足胜利条件。
- OnTurnStart
	- **描述**：回合开始事件（记录事件名即可）。
- OnTurnEnd
	- **描述**：回合结束事件（记录事件名即可）。
- OnPlayerActionEnd
	- **描述**：玩家点击“结束回合”按钮时触发的事件（记录事件名即可）。
- OnAllChessMoved
	- **描述**：所有棋子移动完毕时触发的事件（记录事件名即可）。